# 接口调用日志功能

## 功能概述

本项目已集成了完整的接口调用日志功能，通过 `LoggingInterceptor` 拦截器自动记录所有HTTP请求和响应的详细信息。

## 日志记录内容

### 请求日志
- 请求时间戳
- HTTP方法 (GET, POST, PUT, DELETE等)
- 请求URL
- 客户端IP地址
- User-Agent信息
- 请求体参数 (自动过滤敏感信息)
- 查询参数 (自动过滤敏感信息)
- 路径参数 (自动过滤敏感信息)

### 响应日志
- 响应时间戳
- HTTP状态码
- 请求处理耗时 (毫秒)
- 响应数据 (开发环境显示，生产环境隐藏)
- 错误信息 (如果发生错误)

## 敏感信息过滤

系统自动过滤以下敏感字段，在日志中显示为 `***`：
- `password`
- `token`
- `authorization`
- `secret`
- `key`

## 日志示例

### 成功请求日志
```
[2024-01-15T10:30:00.000Z] GET /test - 开始处理请求 - IP: 127.0.0.1 - User-Agent: Mozilla/5.0...
查询参数: {"name":"张三","age":25}
[2024-01-15T10:30:00.150Z] GET /test - 响应成功 - 状态码: 200 - 耗时: 150ms
响应数据: {"data":{"message":"测试接口","data":{"name":"张三","age":25},"timestamp":"2024-01-15T10:30:00.000Z"}}
```

### 错误请求日志
```
[2024-01-15T10:30:00.000Z] GET /error-test - 开始处理请求 - IP: 127.0.0.1 - User-Agent: Mozilla/5.0...
[2024-01-15T10:30:00.050Z] GET /error-test - 响应错误 - 状态码: 500 - 耗时: 50ms
Error: 这是一个测试错误
    at AppController.testError (/app/src/app.controller.ts:45:11)
    ...
```

## 配置说明

### 环境变量
- `NODE_ENV`: 设置为 `production` 时，响应数据不会在日志中显示
- `PORT`: 应用端口号，默认3000

### 拦截器顺序
日志拦截器在响应拦截器之前执行，确保能够记录到完整的请求和响应信息。

## 测试接口

项目提供了以下测试接口来验证日志功能：

1. `GET /` - 基础测试接口
2. `GET /test?name=张三&age=25` - 带查询参数的测试接口
3. `POST /user` - 创建用户接口 (需要请求体)
4. `GET /user/123` - 获取用户信息接口
5. `GET /error-test` - 错误测试接口

## 使用建议

1. **生产环境**: 建议配置日志文件输出，避免控制台日志过多
2. **性能监控**: 可以通过日志分析接口响应时间，识别性能瓶颈
3. **安全审计**: 定期检查日志，识别异常访问模式
4. **错误追踪**: 利用错误日志快速定位和解决问题

## 自定义配置

如需自定义日志格式或过滤规则，可以修改 `src/common/interceptors/logging.interceptor.ts` 文件中的相关方法。 